## Keynote: Android Graphics

- 2005
    - Skia
    - Made for devices having 80 MHz CPU
    - Classes like Paint, Canvas were JNI wrappers around Skia
    - Stateful, immediate mode, no allocations
    - Paint class is bad... State object but also provides computations
    - Canvas overlaps Paint
    - Allocations were not recommended so methods were doubled: object args / primitive args
    - Cool things were possible with Android Graphics APIs from the start
    - But they were horrible to use
- Since then
    - (...)
    - Shaders
- Now
    - Modern Android Graphics
    - `core-ktx` lib includes graphics APIs
    - Compose lets you take any component and draw on top of it
    - With modifiers like `drawWithContent` or `drawWithCache`
    - Android U brings new Path API
    - Back-ported
    - `v9` library: 9-patches with vectors
    - `graphics-shapes` library to create rounded polygonal shapes
    - Better than `drawRoundRect`
    - Like stars, "rounded polygons", polygons
    - With automatic morphing between shapes (very hard to implement ‚áí based on assumptions)
    - Other libs
    - CameraX
    - ExoPlayer
- Future
    - More Path features
    - Shapes: customizations, morph

## En qu√™te de perf

- Pierre-Yves Ricau
- Square ‚áí Block
- Square does business management software
- Including hardware like payment device with ticket printer
- Square came to France 1-2 years ago
- Ships lots of code in essentially 1 application
- Focus on profiling
- Rule no 1: keep it real ‚áí stay close to users' reality
    - Identify a specific scenario
    - On a real production account
    - And a real device
    - Release profile-able build, not debug ‚áí `perf` build type based on release with `profileable` manifest flag 
    - Talk uses the Signal open source app, modified to add perf. problems
- Outside in
    - UX perspective, not code ‚áí *don't jump to the code*
    - Whole system, not only app
    - Write "signals" and facts, don't try random fixes 
- Investigation
    - Using `scrcpy`
    - Launching Signal
    - Startup seems slow
    - Using Perfetto instead of Android Studio (faster) ‚áí ui.perfetto.dev
    - 1st step: find timeline where app is slow
    - Gives a failing command
    - Fix then execute, run scenario
    - Ctrl-C opens trace in web UI
    - Yellow means app "wants" to run but does not ("preempted")
    - 2nd step: what happens?
    - ‚áí Here it's `bindApplication`
    - 3rd step: find state of (main) thread
    - ‚áí Spending 2.6 seconds sleeping
    - Main thread waiting indicates other threads are working
    - ‚áí Shared preferences thread works while main thread sleeps
    - Back to AS
    - Open Profiler
    - Select the right profile-able process
    - Choose Call-stack sample (faster, more precise, lower level, new)
    - Record call-stack sample
    - How to connect to the process without it being started (to profile app startup)?
    - ‚áí Put a `Thread.sleep` in `Application` class constructor
    - (Export using the floppy disk icon just in case)
    - Open up main thread row
    - Select `bindApplication`
    - Open flame graph
    - ‚áí Spending lots of time in `SharedPreferencesImpl.getString`
    - ‚áí Loading a string value of 200 MB takes some time
- Perfetto *really* needed?
- Investigating scrolling showing "jank"
    - AS doesn't show anything usable (comes from kernel call?)
    - Perfetto shows HeapTaskDaemon thread taking time (GC)
    - Show heap size too
    - ‚áí Scrolling increases memory use, indicates memory leak
    - Use LeakCanary
    - Record allocations in AS (debuggable build)
    - ‚áí Creating large arrays puts memory pressure, triggers GC
- Investigating conversation issue
    - Not finding the right place/thread in timeline
    - Use `Trace.beginAsyncSection`: 
        https://developer.android.com/reference/android/os/Trace#beginAsyncSection(java.lang.String,%20int)
    - Then use AS profiler

## Clean Codebase with Lint Rules

- Sinan Kozak
- Ktlint: only Kotlin
- Android Lint for Android: not only Android üôÉ
- Manages Java, Kotlin, layouts, manifests, Gradle, Proguard, etc.
- Prevent runtime errors
    - String format detector: inconsistencies e.g. in number of arguments between translations
    - Translucent view detector: fixed orientation not supported with translucent theme above Android O
    - Intent filter exported receiver: Intent with filters should be exported on Android > 12 (causes failed install)
    - Notification trampoline: launching activity from broadcast/service forbidden at runtime
    - Mutating shared prefs: `SharedPreferences.getStringSet` result must not be modified (risk of inconsistent data)
    - Java performance detector: Prefer faster APIs (draw allocation, use sparse array)
- Open-source lint rules
    - `vanniktech/lint-rules` 
    - `slackhq/*lint*`
    - (...)
- Sample lint rules
    - `googlesamples/android-custom-lint-rules`
- Or ask ChatGPT...

## Staying passionate

- Jeroen Mols
- Defining moments?
- Best use of his time?
- 2012: not a real app developer
    - Building own app
    - Wi-FileTransfer
    - ‚áí Shipping is a thrill
- 2013: bad performance review
    - Doing many thinks including meetings...
    - Not having the expected impact
    - Time spent on email/Slack adds up
    - Create impact != working long hours
    - ‚áí Focus on impact... What is expected from you?
- 2014: all talks rejected
    - "1st successful rejection"
    - Talk was rejected
    - Got a free ticket
    - But was finally scheduled
    - ‚áí Create your opportunities
- 2015: being a father
    - Fundamental drive in life
    - ‚áí Assume good intentions
- 2017: ~~becoming a GDE~~
    - Not defining
    - Not about skill
    - More about helping community
- 2017: building social following
    - Worked 132 working days on blogging, tweeting, talks!
    - ‚áí Don't *need* to blog/speak to be a good dev
- 2018: promotion that wasn't 
    - At Phillips
    - Lead a team
    - Things not going well
    - Not coding
    - Eventually good results
    - ‚áí May not want that promotion... Instead how to maximize work returns?
- 2019: going full remote / getting fired
    - South Africa (Wise), same timezone
    - Contract cancelled right before joining
    - Then freelancing (Plaid)
    - US company
    - ‚áí Dare to take risk
- 2020: stuck in Android
    - Build SDKs
    - Not as passionate anymore about Android
    - In retrospect, should have stopped Android years ago
    - Took a full-stack dev job in another company
    - ‚áí Learning is fun
- Wrap up
    - ‚áí Shipping is a thrill
    - ‚áí Focus on impact... What is expected from you?
    - ‚áí Create your opportunities
    - ‚áí Assume good intentions
    - ‚áí Don't *need* to blog/speak to be a good dev
    - ‚áí May not want that promotion... Instead how to maximize work returns?
    - ‚áí Dare to take risk
    - ‚áí Learning is fun

## Design for foldables

- Snapp designer (?), Android engineer (?)
- Tablets, Chromebooks
- Patterns seen in web design
- Hybrid device category between phone & tablet
- Flexible display, hinge: fold inwards, outwards, horizontal/vertical split
- What's next: Pixel Fold, OnePlus, rollables, hybrids, multi-fold?
- Use cases: reading, videos and calls, gaming, multitasking 
- New challenges: different screen states, transitions, new interactions (gestures, drag and drop)
- UX principles
    - More space ‚áí more content?
    - Counter example: Sling TV app has multiple levels of content
    - ‚ö†Ô∏è cognitive overload
    - Wikipedia on larger screen ‚áí not best experience
    - Medium limits text content width whatever the screen
- Adaptive patterns
    - Reveal adaptive pattern: more UI reveals on larger device
    - Grid (?): change layout on larger screen e.g. from list to grid
    - (?): (?)
    - Reflow pattern: change disposition of content when larger
    - Expand pattern: same layout but larger width with upper bound
    - Reposition pattern: UI element moves e.g. FAB that relocates from mobile to tablet
- Canonical layouts
    - Window size classes
    - One canonical layout for each size class
    - Feed
    - Supporting pane: bottom sheet moves to side
    - List detail: list items plus details side by side
- Show me code
    - Top level navigation: bottom navigation, navigation rail
    - Single navigation graph
    - How to implement canonical layouts
    - List detail with `SlidingPaneLayout`
        - Use weight to distribute extra space
        - E.g. list is 300 dp / weight 0.5, detail is 400 dp / weight 0.5
    - Feed
        - Phone: LinearLayoutManager
        - Larger screen: Grid/Staggered/FlexBoxLayoutManager
    - Supporting pane
    - Hero pane
        - E.g. Youtube theater mode
        - Hero, description, up-next panes
    - Constraint-sets
        - Closed / folded / fully open
    - Postures
    - Detect folding features
        - Jetpack window manager lib
        - Supports Compose
        - Postures: `FoldingFeature` has `State` and `Orientation`
    - Emulators
        - Fold-in/out AVD, rollable
        - Extended controls, virtual sensors
    - Layout validation tool window on XML layout
    - Locating fold
        - Adapt the app to the fold
        - (?)

## AI won't take your job

- Speaker
    - Orel Zion
    - Viz.ai
    - Android developer
- AI changes fast
    - GPT 3.5, 4
    - Bard
    - ChatGPT plugins
    - Etc.
- People show on Youtube how ChatGPT codes apps for them (better in JS than Android/iOS)
- What's AI
    - Speaker asked ChatGPT
    - Machine learning: give AI examples and "explain" what they are by tagging the examples
- Programming with AI
    - ChatGPT
        - Naming
        - Views ‚Üí composables
        - APIs ‚Üí data classes
        - Open Commit: read code, write best commit message
        - Write PRs in Markdown following template from a list of commits
        - Learn things
    - CoPilot
        - Android Studio Plugin
        - 3 months free
- Let's code
    - Demo: chat app, sarcastic friend, uses ChatGPT API
    - Let's build it
    - Speaker shows API request/response in API client
    - Asks ChatGPT to generate client for OpenAI `completion` API
    - Has a pro subscription
    - Based on JSON request and response
    - Creates `ChatRepository` repository interface using CoPilot
    - And implementation
    - Encounters unstable internet connection ("have to do it ourselves")
    - CoPilot suggests code in the IDE
    - Now creates an `AvatarView` composable, asks ChatGPT
    - Answer bad
    - Uses Phind since this Monday ‚áí better answer
    - Now creates a preview composable using CoPilot
    - Finally works
    - Needs a preview for the `MessagesList` composable
    - Generates a list of sample messages
    - Executes app and tries a message
    - Fails with missing API key
    - Fixed... Working

## Unusable or un-debuggable

- Louis CAD
    - Splitties
    - Charts-kt
    - Doing Wear OS apps
- LazyColumn missing basic features
    - Item animations feature missing 
    - ScalingLazyColumn poor scrolling perf
    - Issue closed within few days *but* only in release mode, not debug
    - So you can't have an app that is both `debuggable` and usable
    - ‚áí Hack around
    - LazyColumn vs RecyclerView
    - Simple high-level API | Complex lower-level API
    - No insertion/removal anims | Animates all item changes by default
    - Bad perf in debug | Smooth as content
    - Scrolling friction on GW4 | NP
    - Letting LazyColumn use RecyclerView
    - ‚áí LazyColumnWithRecyclerView... Pros of RV, with a simple API
- The code
    - LCWRV with same interface, drop-in replacement
    - Content lambda not `@Composable`, tricky
    - Handle digital-crown precise scrolling tricky too
    - Because of how Compose handles focus
- Links
    - [Unusable or Undebuggable? Rebelling against "best practices" - Speaker Deck](https://speakerdeck.com/louiscad/unusable-or-undebuggable-rebelling-against-best-practices)
    - [LouisCAD/Splitties: A collection of hand-crafted extensions for your Kotlin projects.](https://github.com/LouisCAD/Splitties)

## Rise and fall of feature teams

- Speaker
    - Danny Preussler
    - SoundCloud
- Speaker shows Agile manifesto
- Cross-functional feature team? People with different expertise working toward common goal
- Spotify Agile model (2014/2015) adopted by other companies
- Top-down model: Here's a river, need a bridge ‚áí build it
- Feature teams, bottom-up model
    - Need to cross river ‚áí figure out how
    - "Perfect" team: cross functional with every platform, at least pairs
    - But reality: only 1 Android dev ‚áí "I want to pair with someone"
    - Android collective?
        - Hard to organize
        - Hard to collaborate without functional context
        - Doesn't solve pairing problem
    - New silos: each team build own thing, own tech
    - Conway's law: code structure follows org, but also follows previous orgs (?)
    - Trickle-down KPIs
        - Important KPIs given by leadership, good for business
        - Apps optimized to increase given KPIs, works
        - But apps are bad for users e.g. Amazon
        - Tech KPIs forgotten
    - SoundCloud CPO. stated speed & perf are most important for any product
    - Solution: infrastructure squads, client app squads, feature squads
    - Core team: giving less autonomy to teams? ‚áí becomes "tech debt team"
    - Wrong model?
    - HBR: 75 % of cross-functional teams dysfunctional
    - Works for Google, Amazon, Netflix, Spotify? 
        - But they have specific problems 
        - Because of larger scale in terms of number of devs, users
        - And the ability to fix issues with their models 
        - Like increase of build times following adoption of mono-repos
- Return of platform teams at SoundCloud
    - New silos? Not really 
        - Less silos: Android, iOS, backend instead of all the feature teams
        - No large upfront tickets, devs work directly with designers
        - Regular syncs across company
        - (...)
    - Kept some things: release trains, feature toggles
    - Have people who care
    - YAGNI: micro-services, Bazel, mono-repos, modularization, cross-functional teams

## Practical ADB to enhance your life!

- Ben Kadel
    - `androiddev.social/@ben_kadel`
    - GitHub: Kardelio
    - Principal engineer
    - Babbel
    - NDCP: Kind of crazy speaker
    - linktr.ee/bkadel
- Practical ADB
- Agenda
    - ADB brief explanation
    - Automated input flows
    - Dumpsys
    - (...)
- Demos use unrooted devices
- Automated input flows
    - Send input events
    - `adb shell input`
    - E.g. `adb shell input tap 100 100`
    - `tap` but also `swipe`, `text`, `keyevent`
    - Set "pointer location" debug setting to show pointer location
    - Or use `adb shell settings put system pointer_location 1`
    - Script: either Bash script e.g. `login.sh`
    - But switching devices causes pointer locations to fail
    - Run `adb shell uiautomator dump`
    - Outputs XML including bounds of UI "node" 
    - Compute the x and y
    - In a file on device
    - `output=$(adb exec-out uiautomator dump /dev/tty)`
    - But `uiautomator dump` is slow
    - So `pip3 install uiautomator2`
    - See `linktr.ee` or Gist: "uiautomator2 tap node if exists"

