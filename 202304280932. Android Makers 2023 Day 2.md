## A year in Android

- Speaker
    - Ash Davies
    - Android Dev
    - Android, Kotlin GDE
    - Snapp Mobile GmbH
- What happened since July 2022
    - Compose, KMM, perf & monitoring, coroutines, form factors, self advocacy & soft skills, testing, plugin dev, Jetpack Glance, modern Android dev
    - NDCP: Just listing most interesting news
    - [cashapp/zipline: Run Kotlin/JS libraries in Kotlin/JVM and Kotlin/Native programs](https://github.com/cashapp/zipline)
    - Generic inline classes Kotlin feature. NDCP: Use `value class`?
    - [Kotlin Multiplatform for Cross-Platform Development | Kotlin Multiplatform Mobile](https://kotlinlang.org/lp/mobile/)
    - [Android Developers Blog: Announcing an Experimental Preview of Jetpack Multiplatform Libraries](https://android-developers.googleblog.com/2022/10/announcing-experimental-preview-of-jetpack-multiplatform-libraries.html)
    - Public preview: [JetBrains Fleet: The Next-Generation IDE by JetBrains](https://www.jetbrains.com/fleet/)
    - `androidx.test:ext.truth` update. NDCP: What is this `ext` thing? Useful? See https://developer.android.com/jetpack/androidx/releases/test#:~:text=1.0.0%2Dalpha01-,ext.truth,-1.5.0
    - Desugaring update (Desugaring allows using recent version of Java on old versions of Android)
    - GitHub Copilot X
    - AndroidX core SplashScreen
    - androidstudygroup.github.io/conferences
    - https://github.com/AndroidStudyGroup/conferences

## $weet (sweet) architecture

- Speaker
    - Benoit Quenaudon
    - Android dev
    - Cash App
- Preliminary NDCPs
    - https://code.cash.app/bridge-between-your-code-and-compose
    - https://code.cash.app/bridge-between-your-code-and-compose#:~:text=%40Composable%0Afun%20profilePresenter(%0A%20%20userFlow%3A%20Flow%3CUser%3E%2C%0A%20%20balanceFlow%3A%20Flow%3CLong%3E%2C%0A)%3A%20ProfileModel%20%7B%0A%20%20val%20user%20by%20userFlow.collectAsState(null)%0A%20%20val%20balance%20by%20balanceFlow.collectAsState(0L)%0A%0A%20%20return%20if%20(user%20%3D%3D%20null)%20%7B%0A%20%20%20%20Loading%0A%20%20%7D%20else%20%7B%0A%20%20%20%20Data(user.name%2C%20balance)%0A%20%20%7D%0A%7D
    - https://code.cash.app/the-state-of-managing-state-with-compose#:~:text=The%20Molecule%20library%20is%20the%20idea%20that%20you%20can%20use%20Compose%20solely%20as%20a%20mechanism%20of%20producing%20state%20values%20and%20not%20as%20something%20which%20does%20rendering
- Cash app not using fragments, `ViewModel`s, etc.
- Few years ago Cash had custom `View`s depending on presenters
- Unidirectional UI/presenter flow
- Speaker shows simple screen, readonly with description, picture, Continue and Close buttons
- Defined a Ui interface
    - Can be sent a model
    - Can be given a event receiver
- Implemented by concrete `View` 
- With Compose, defined an abstract `View` class in that context
- Paparazzi lib to test screen 
- NDCP: But is this the same "framework" for Compose and `View` implementation?
- Automated testing without a device/emulator, runs on JVM, really fast: 1-2 sec
- Snapshots recorded to repo, taken as "golden files"
- CI compares results & golden files, outputs difference in percent to golden file e.g. "different by 7.6 %"
- About presenter
- Exposes a `Flow<UiModel>` and a `sendEvent` method, indirected through a `Binding` sub interface
- Have to call a `start` method to get the `Binding`
- NDCP: Presenters expose `Flow`s but can use RX? No, there seems to be RX-specific screens
- Speaker explains how it works for RX presenters
- Presenting Molecule
- What if a presenter could be implemented as a `@Composable` function?
- So that it can be reactive without showing it
- "Molecule takes a composable function and gives you a `Flow`"
- A cold `Flow` or a hot `StateFlow`
- Molecule can expose RX `Observable`s or Kotlin `Flow`s
- ⇒ Implement a presenter as a composable function that _looks imperative_ but _is reactive_
- Now about navigation
- Defines `Screen` interface (parcel-able)
- `Broadway`: closed-source in-house lib for above "framework" over Molecule, plus factories for views, presenters
- Speaker shows how presenter converted to Observable through an `asPresenter` extension
- ⇒ App doesn't depend on a specific "thing" other than Molecule, Flow, RX
- "Views" can similarly be abstracted from underlying "thing" through factories, be it `View`s or composables
- NDCP: 
    - Broadway really useful *right now*? 
    - Productivity hit from the indirection of using Broadway over "simple" composables and flows?
    - What about onboarding non-Square developers
- References: Molecule, Turbine, Paparazzi, Circuit

## Off to the races

- Speaker
    - Bell Innovation lab (5G, MEC (Multi-Edge Compute), 3 months project)
    - Etienne Caron
    - Francois Légaré
- Overview
    - Where it began...
    - Mario Kart game in augmented reality
    - Possible over 5G coast to coast (Canada)?
    - Constraints: F1, signal congestion on island, low-latency play, no destruction derby
    - Team: 5G/RF engineers, data scientists, SL (?), consultants
- Solution
    - Client app (web), support stack (cloud, edge), car stack (native app, hardware), all communicate through WebRTC
    - Private 5G not fancy Wi-Fi... Specifics: no public spectrum in Canada ⇒ private network, devices FW, ⚠️ UPF (User Plain Function), 5G > Wi-Fi
    - MEC: For hosting AI overseeing inference
    - Anti destruction-derby: AI monitors cars and raises yellow/red flags
    - Track: built at Bell
    - Car: Android phone sitting in the car
- Demo
    - Web app using WebRTC
    - Private Wi-Fi (not 5G)
    - Prototype on stage, broadcasts first-person video to web app through Wi-Fi
    - Remote controlled using a joypad
    - Phone sitting in the car shows face of driver in real time
- Technical details
    - Software
        - Kotlin Multiplatform 
        - `webrtc-kmp` WebRTC SDK
        - https://webrtc.org: "Real-time communication for the web"
        - Code
            - App modules: Android app, JS app, shared lib 
            - `RTCModel`, `RTCData`
            - Data has current RTC session `Job` property
            - Model has `userMediaSetup` method to configure audio, video, camera
        - Design
            - How WebRTC negotiates session
            - Client calls the car ("Offer")
            - Car replies ("Answer")
            - Signaling solution (build yourself): Offer, Answer, `ICECandidate`
            - Offer, answer pass through Firebase
            - "Serverless" signaling service
            - Firebase doesn't have a Kotlin Multiplatform lib
        - Microcontroller
            - ESP32 Lora32, Wi-Fi, BLE, OLED screen, 433 MHz ⇒ 20 euros
            - Arduino IDE
            - VSCode with PlatformIO
    - Hardware
        - How to connect phone to microcontroller? 
        - Use `usb-serial-for-android`, USB adapter ⇒ just works
- Next year: consumer game?
- Questions
    - Need $1000 Android phone?
    - Initially Pi
    - AI on the phone
    - Camera stabilization
    - Allows skipping a few steps

## Confetti: building conference app

- Speakers
    - John O'Reilly
    - Martin Bonnin
- Overview
    - Kotlin Multiplatform
        - *Optional* code sharing
    - Declarative UI
    - GraphQL
        - Open-source query language to describe, run APIs
        - Type-safe, no over-fetching, self-documenting
        - Graph*i*QL
        - GraphQL Kotlin (server lib)
            - Kotlin → GraphQL types, schema
        - Apollo Kotlin (client lib)
            - GraphQL queries → Kotlin models
    - github.com/joreilly/Confetti
- Live coding
    - Confetti backend 
        - Ktor project generator: Gradle Kotlin, Netty
        - Live coding
        - Speaker using live templates
        - Showing Gradle build script
        - Ktor plugin includes a JAR runner
        - Switching to `application.kt`
        - Write `RootQuery` implementing `Query` with `hello` method returning hardcoded text
        - Then `Application.graphQLModule` extension to configure Ktor
        - And `main` function calling `embeddedServer` function
        - Local web server exposing a `/graphql` route to execute queries
        - JSON file with conference data was prepared
        - Defining model classes e.g. `Session`, `Data`, etc.
        - Changing `RootQuery`  to provide `sessions` method with `@GraphQLDescription`
        - Query: `{ sessions { id title description start speakerIds } }`
        - Drilling into graph data: `{ sessions { id title description start speakers { id name tagline } } }`
        - Adding corresponding fields to `Session`
        - GraphQL type system has nullability
        - Implementing Kotlin type coercion on `start` and `end` time properties by implementing `Coercing` 
    - Frontend
        - John starts coding Android, iOS client apps
        - Generate models using live templates (LT)
        - Repository (?)
        - `SessionsUiState` interface
        - Extending `KMMViewModel` to implement a `ViewModel` (custom class, or lib? ⇒ [rickclephas/KMM-ViewModel: Library to share Kotlin ViewModels with SwiftUI](https://github.com/rickclephas/KMM-ViewModel)?)
        - Composables (LT)
        - Similarly in SwiftUI
        - Uses `KMMViewModel` too
        - Update query to bring room name in (plugin updates Kotlin models when queries are changed)
        - Compose and SwiftUI same
        - Confetti app available on app stores e.g. https://apps.apple.com/fr/app/confetti/id1660211390?l=en

## The art of KMP

- Speaker
    - Lena Stepanova
- Why?
    - Pet project, vocabulary app
    - Local "backend" in the app
- New app design
- Frontend: Ktor, Koin, Compose/SwiftUI
- Backend: Node? KMP
- Kotlin backend or Java, Go? Language, code sharing ⇒ yes
- Easiest frameworks for beginners, mature, Ktor server, or something else? 
    - Ktor: easy & well documented
    - Spring: modular, large user base
    - Micronaut: less supported, good perf
    - Vert.x: toolkit not framework, more freedom, less out of the box
    - Hexagon: Kotlin-first toolkit, focus on simplicity
    - Http4k: flexible integration with libs: [HTTP as a Function](https://www.http4k.org/#:~:text=Quick%20Start-,HTTP%20as%20a%20Function,-An%20http4k%20server)
- How?
    - Add backend module using AS wizard
    - Set up basic Ktor server
    - Add routing
    - Set up app with [Shadow](https://imperceptiblethoughts.com/shadow/)
    - Tables and entities with [JetBrains/Exposed: Kotlin SQL Framework](https://github.com/JetBrains/Exposed) ("most difficult part")
    - Set up local DB with PostgreSQL
    - Using Koin (same as frontend ⇒ "nice surprise")
    - Add useful endpoints for recipes
    - Add images to backend using Amazon S3 storage
    - Deploy KMP backend to https://fly.dev

## Animations with Jetpack Compose

- Speakers
    - Antoine Robiez, Worldline
    - Baptiste Carlier, Decathlon
- Overview
    - Animate? Bring something to life
    - UI component has states: enabled, disabled, expanded, collapsed...
    - UI screen has states: loading, loaded, empty
    - Support: "purr-fect" application
    - Missing animations...
- Live coding
    - Extended FAB: 
        - Boolean state expands through `AnimatedVisibility`
        - Icon modifier float state, `animateFloatAsState` scales icon
    - Temperament card arrow
        - Use `animateFloatAsState` 
        - Arrow rotation `rotate` modifier
        - To rotate arrow icon
    - Temperament detail text
        - AnimatedVisibility with `enter`, `exit` properties and `slideIn/OutHorizontally`
        - To animate temperament text 
        - Or `slideIn/OutVertically`
        - But default behavior is OK here
    - Animate property from state: possible for other types incl. colors
    - Favorite button color
        - Use `animateColorAsState`
        - Don't forget property delegate
    - Interpolators?
    - How a property changes over time: linear, slow-in/fast-out (dropped object falling), slow-out (thrown object in the air), slow-in/slow-out (car starting slow, accelerating then going slower before stopping)
    - Animated vector drawable?
    - [Shape Shifter](https://shapeshifter.design/)
    - Change FAB vector, use `animatedVectorResource`
    - Use `rememberAnimatedVectorPainter` giving resource and state
    - Bound to boolean state
    - Reverse state to trigger animation
    - What about the list when items change?
    - `RecyclerView` had `DiffUtils`
    - Compose has `animateItemPlacement` in `LazyItemScope`
    - Scroll to top on reverse: `LazyListState.animateScrollToItem`
    - Transitions between screens: enter, exit, pop-enter, pop-exit: see https://stackoverflow.com/a/41021427/1665730
    - `AnimatedNavController` in [Guide - Accompanist](https://google.github.io/accompanist/navigation-animation/) lib
    - `rememberAnimatedNavController`
    - ⚠️ Accompanist `@Composable`
    - `AnimatedNavHost` instead of `NavHost`
    - Same as XML enter/exit/pop-enter/pop-exit
    - Missing shared element between screens
    - Splash screen animation
    - Twerking cat
    - Cat view in 2 parts
    - `Box` for cat's ass
    - Use `graphicsLayer` modifier, giving `assRotation` animated state
    - Rotate the box around Z axis
    - `AnimationSpecs`: tween (easing curve over given duration), spring (physics-based animation), keyframes (based on snapshot values at specified timestamps), repeatable, infiniteRepeatable, snap
    - Progress bar
    - `Animatable` state, use `animateTo` with `tween` `animationSpec`
    - `LaunchedEffect` triggered during composition, even if composable not displayed
- Wrap up
    - Animated vector drawable, useful?
    - Motion-layout not mentioned, usable ✅, useful 🤔
    - Ask for animated mockups/wireframes
    - github.com/enthuan/compose-animations

